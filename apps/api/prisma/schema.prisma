// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id          String   @id @default(cuid())
  email       String   @unique
  totalEquity Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  trades           Trade[]
  equitySnapshots  EquitySnapshot[]
}

model Trade {
  id           String   @id @default(cuid())
  userId       String
  symbol       String   // Limit symbol length
  direction    String   // 'LONG' | 'SHORT'
  entryPrice   Float
  positionSize Float
  stopLoss     Float
  exitPrice    Float?
  status       String   // 'ACTIVE' | 'CLOSED'
  entryDate    DateTime
  exitDate     DateTime?
  realizedPnL      Float?
  riskAmount       Float    // Monetary risk amount
  riskPercentage   Float    // Risk as % of equity at time of entry
  notes        String?  // Allow longer notes
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  user           User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  methodAnalysis MethodAnalysis[]
  mindsetTags    MindsetTag[]
  
  // Indexes for performance
  @@index([userId, status])
  @@index([userId, createdAt])
}

model MethodAnalysis {
  id         String   @id @default(cuid())
  tradeId    String
  timeframe  String   // 'DAILY' | 'FOUR_HOUR' | 'ONE_HOUR'
  indicator  String
  signal     String
  divergence String   // 'BULLISH' | 'BEARISH' | 'NONE'
  notes      String?
  createdAt  DateTime @default(now())
  
  trade      Trade    @relation(fields: [tradeId], references: [id], onDelete: Cascade)
  
  @@index([tradeId])
}

model MindsetTag {
  id        String   @id @default(cuid())
  tradeId   String
  tag       String
  createdAt DateTime @default(now())
  
  trade     Trade    @relation(fields: [tradeId], references: [id], onDelete: Cascade)
  
  @@index([tradeId])
  @@index([tag])
}

model EquitySnapshot {
  id          String   @id @default(cuid())
  userId      String
  totalEquity Float
  timestamp   DateTime @default(now())
  source      String   // 'TRADE_CLOSE' | 'MANUAL_UPDATE' | 'DAILY_SNAPSHOT' | 'CASH_DEPOSIT' | 'CASH_WITHDRAWAL'
  amount      Float?   // Amount of the adjustment (positive for deposits, negative for withdrawals, null for snapshots)
  description String?  // User-provided description for manual adjustments
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, timestamp])
  @@index([userId, source])
}